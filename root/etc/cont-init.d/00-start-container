#!/usr/bin/with-contenv bash
# shellcheck shell=bash

umask "${UMASK}"

echo "
----------------------------------------------------------------------
ENVIRONMENT
----------------------------------------------------------------------
PUID=${PUID}
PGID=${PGID}
UMASK=${UMASK}
TZ=${TZ}
ARGS=${ARGS}
INTERVAL=${INTERVAL}
DETECTION_MODE=${DETECTION_MODE}
LOG_LEVEL=${LOG_LEVEL}
CF_USER=${CF_USER}
CF_APIKEY=${CF_APIKEY}
CF_APITOKEN=${CF_APITOKEN}
CF_APITOKEN_ZONE=${CF_APITOKEN_ZONE}
CF_ZONES=${CF_ZONES}
CF_HOSTS=${CF_HOSTS}
CF_RECORDTYPES=${CF_RECORDTYPES}
INFLUXDB_ENABLED=${INFLUXDB_ENABLED}
INFLUXDB_HOST=${INFLUXDB_HOST}
INFLUXDB_DB=${INFLUXDB_DB}
INFLUXDB_USER=${INFLUXDB_USER}
INFLUXDB_PASS=${INFLUXDB_PASS}
----------------------------------------------------------------------
"

if [[ ! "${PUID}" -eq 0 ]] && [[ ! "${PGID}" -eq 0 ]]; then
    echo "Executing usermod..."
    mkdir "/tmp/temphome"
    usermod -d "/tmp/temphome" hotio
    usermod -o -u "${PUID}" hotio
    usermod -d "${CONFIG_DIR}" hotio
    rm -rf "/tmp/temphome"
    groupmod -o -g "${PGID}" hotio
else
    echo "Running as root is not supported, please fix your PUID and PGID!"
    exit 1
fi
